jobs:
  fetch-and-send:
    runs-on: ubuntu-latest
    steps:
      # 1️⃣ 检出仓库
      - name: Checkout
        uses: actions/checkout@v6

      # 2️⃣ 安装 uv 环境
      - name: Setup uv
        uses: astral-sh/setup-uv@v7.1.4

      # 3️⃣ 运行脚本
      - name: Run Zotero-Arxiv-Daily (Debug quant-ph)
        env:
          ZOTERO_ID: ${{ secrets.ZOTERO_ID }}
          ZOTERO_KEY: ${{ secrets.ZOTERO_KEY }}
          SENDER: ${{ secrets.SENDER }}
          RECEIVER: ${{ secrets.RECEIVER }}
          SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_API_BASE: ${{ secrets.OPENAI_API_BASE }}
        run: |
          echo "===== Writing debug config for quant-ph ====="
          # 写入 debug 配置，抓最新 5 篇 quant-ph
          cat <<EOF > config/custom.yaml
zotero:
  user_id: \${oc.env:ZOTERO_ID}
  api_key: \${oc.env:ZOTERO_KEY}
  include_path: null

email:
  sender: \${oc.env:SENDER}
  receiver: \${oc.env:RECEIVER}
  smtp_server: smtp.qq.com
  smtp_port: 465
  sender_password: \${oc.env:SENDER_PASSWORD}

llm:
  api:
    key: \${oc.env:OPENAI_API_KEY}
    base_url: \${oc.env:OPENAI_API_BASE}
  generation_kwargs:
    model: gpt-4o-mini

source:
  arxiv:
    category: ["quant-ph"]

executor:
  debug: true
  send_empty: true
  max_workers: 10
  max_paper_num: 5
  source: ['arxiv']
  reranker: local
EOF

          echo "===== Custom config ====="
          cat config/custom.yaml
          echo "===== Running Zotero-Arxiv-Daily ====="
          export DEBUG=true
          uv run src/zotero_arxiv_daily/main.py
